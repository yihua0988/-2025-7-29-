const mediaSize = 800;

function draw_ad(rsp) {
    if (rsp.length == 0) {
        jQuery('#ad_card' + uniBox).hide();
        return true;
    }

    //jQuery('#card_pool' + uniBox).html(rsp); // 把內容填進去
    document.getElementById('card_pool' + uniBox).innerHTML = rsp;
    jQuery('#ad_card' + uniBox).show();
    var mediaQuery = window.matchMedia('(max-width: 799px)');
    var divWidth = jQuery('#ad_card' + uniBox).width();
    var padWidth = ((divWidth - 280) / 2);

    if (mediaQuery.matches) {
        jQuery('.left-opa' + uniBox).css({
            "position": "absolute",
            "top": "50px",
            "z-index": "4",
            "width": padWidth + "px",
            "height": "360px",
            "opacity": "0.4",
            "padding": "0",
            "cursor": "pointer",
            "background-color": "rgba(255, 255, 255, 0.9)",
            "left": "0"
        }).show();

        jQuery('.right-opa' + uniBox).css({
            "position": "absolute",
            "top": "50px",
            "z-index": "4",
            "width": padWidth + "px",
            "height": "360px",
            "opacity": "0.4",
            "padding": "0",
            "cursor": "pointer",
            "background-color": "rgba(255, 255, 255, 0.9)",
            "right": "0"
        }).show();
    } else {
        jQuery('.left-opa' + uniBox).hide();
        jQuery('.right-opa' + uniBox).hide();
    }

    jQuery('#card_pool' + uniBox).slick({
        speed: 300,
        slidesToShow: 3,
        slidesToScroll: 3,
        centerMode: false,
        arrows: true,
        prevArrow: '<button class="slick_prev"><img src="' + imgPath + 'btn-left.svg" /></button>',
        nextArrow: '<button class="slick_next"><img src="' + imgPath + 'btn-right.svg" /></button>',
        respondTo: 'window',
        useCSS: true,
        useTransform: true,
        responsive: [{
            breakpoint: 1200,
            settings: {
                slidesToShow: 2,
                slidesToScroll: 2
            }
        }, {
            breakpoint: 992,
            settings: {
                slidesToShow: 3,
                slidesToScroll: 3
            }
        }, {
            breakpoint: mediaSize,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                centerMode: true,
                infinite: true,
                centerPadding: padWidth + 'px'
            }
        }]
    });

    jQuery('#ad_card' + uniBox).show();
}

jQuery(document).ready(function() {
    jQuery.ajax({
        type: 'GET',
        url: ajaxInfo,
        async: true,
        timeout: 6000, // sets timeout to 5 seconds
        success: function(d) {
	    console.log("ajax success: ", uniBox);
            draw_ad(d);
        },
        error: function(d) {
            console.log("ajax error: ", d);
        }
    });
});

jQuery(window).resize(function($) {
    var mediaQuery = window.matchMedia('(max-width: 799px)');
    var divWidth = jQuery('#ad_card' + uniBox).width();
    var padWidth = ((divWidth - 280) / 2);

    if (mediaQuery.matches) {
        jQuery('.left-opa' + uniBox).css({
            "position": "absolute",
            "top": "50px",
            "z-index": "4",
            "width": padWidth + "px",
            "height": "360px",
            "opacity": "0.4",
            "padding": "0",
            "cursor": "pointer",
            "background-color": "rgba(255, 255, 255, 0.9)",
            "left": "0"
        }).show();

        jQuery('.right-opa' + uniBox).css({
            "position": "absolute",
            "top": "50px",
            "z-index": "4",
            "width": padWidth + "px",
            "height": "360px",
            "opacity": "0.4",
            "padding": "0",
            "cursor": "pointer",
            "background-color": "rgba(255, 255, 255, 0.9)",
            "right": "0"
        }).show();

    } else {
        jQuery('.left-opa' + uniBox).hide();
        jQuery('.right-opa' + uniBox).hide();
    }
});

function record_and_go(obj) {
    console.log("thest", obj.href, ajaxLog);
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200); // do not care the result
    };
    xhttp.open("GET", ajaxLog+"?url="+obj.href, true);
    xhttp.send();
}

jQuery('.seemore a').click(function() { record_and_go(this); });

const publicState={ua:"",URL:"",urlParams:{},isBWPlusApp:!1,isH5:!1,isPC:!1,isAndroid:!1,isIOS:!1,baseURL:"",resourceURL:"",rAjaxUrl:"",isDev:"",hasApp:!1},userState={isLogin:!1};let redpackStatus;const redpackState={redpackId:"",identityKey:"",eventId:""};Object.defineProperty(redpackState,"status",{configurable:!0,enumerable:!0,get:function(){return redpackStatus},set:function(e){if(redpackStatus===e)return;if(redpackStatus=e,null===e)return;const{initEvent:t,receiveEvent:o,belongUserEvent:n}=outerEvent;switch(e){case 0:t&&(console.log("initEvent"),t());break;case 1:o&&(console.log("receiveEvent"),o());break;case 2:n&&(console.log("belongUserEvent：紅包狀態為2"),n())}}});let redpackSource={diamondImage:"",cardImg:"",init:{},receive:{},home:{},error:{},color:{},cacheImage:[]};const eventFlag={receiveFlag:!0,shareFlag:!0,otherFlag:!0,appLoginFlag:!0,setReceiveFlag:function(e){this.receiveFlag=e},setShareFlag:function(e){this.shareFlag=e},setOtherFlag:function(e){this.otherFlag=e},setAppLoginFlag:function(e){this.appLoginFlag=e}};function getUrlParames(){const e=/[?&]([^=&]*)=([^&]*)/gi;let t={};for(;null!==(t=e.exec(location.search));)publicState.urlParams[t[1]]=t[2]}function splitStr(e=""){let t=[];if(e.includes(",")||e.includes(".")){let o=e.indexOf(",");-1===o?(o=e.lastIndexOf("."),t.push(e.slice(0,o+1)),t.push(e.slice(o+1))):t=e.split(",")}else t=[e];return t}function getCookieBySplitStr(e){let t=document.cookie.split("; ");for(let o=0;o<t.length;o++){let n=t[o].split("=");if(e==n[0])return n[1]}return""}function setCookieStr(e,t,o){if(0!==o){const n=24*o*60*60*1e3,r=new Date(+new Date+n);document.cookie=`${e}=${escape(t)};expires=${r.toUTCString()}; path=/`}else document.cookie=`${e}=${escape(t)}`}function getImageHttps(e){if(!e)return"";let t;return t=e.includes("https:")?e:"https:"+e,redpackSource.cacheImage.includes(t)||loadResource({img:[t]}),t}function setColorValue(e){if(e)for(let t in e)document.documentElement.style.setProperty(`--redpack-${t}`,e[t])}function getColor(e){if(!e)return;let{type:t,backgroundColor:o,topColor:n,rewardColor:r,buttonColor:i,promptColor:a,linkColor:s,border:c,buttonHover:l}=e;const{color:d}=redpackSource;switch(+t){case 0:t="init";break;case 1:t="receive";break;case 2:t="home";break;default:t="error"}d[t]={},o&&(d[t]["window-backgroundColor"]=o),n&&(d[t]["title-color"]=n),r&&(d[t]["content-color"]=r),a&&(d[t]["prompt-color"]=a),s&&(d[t]["link-color"]=s),c&&(d[t]["split-color"]=c),i&&(d[t]["button-backgroundColor"]=i),l&&(d[t]["button-backgroundColor--active"]=l)}function dataResolver(e){try{const{redpackRecordVo:t,pageStyle:o,pageError:n}=e,{id:r,cardUrl:i,couponDetailsInfo:a,redpackRecordInfo:s}=t;let c=[];0!==s.diamondAmount&&c.push(`商周鑽${s.diamondAmount}枚`),0!==a.length&&c.push(`${a[0].productname}`),redpackState.status=+s.status,redpackState.eventId=+s.redpackEventId,redpackState.redpackId=r,redpackSource.diamondImage=getImageHttps(o[0].rewardUrl),redpackSource.cardImg=getImageHttps(i),o.forEach((e=>{switch(+e.type){case 0:redpackSource.init={type:+e.type,backgroundImage:getImageHttps(e.backgroundUrl),mainText:splitStr(e.rewardContent),buttonText:e.buttonContent};break;case 1:redpackSource.receive={type:+e.type,title:e.topContent,backgroundImage:getImageHttps(e.backgroundUrl),imgUrl:getImageHttps(e.rewardUrl),mainText:c,secondaryText:splitStr(e.promptContent),buttonText:e.buttonContent,showCard:!!i},e.linkContent&&(redpackSource.receive.linkText=e.linkContent,redpackSource.receive.link=e.linkUrl);break;case 2:let t=a[0]?a[0].picture:e.rewardUrl;redpackSource.home={type:+e.type,title:e.topContent,backgroundImage:getImageHttps(e.backgroundUrl),imgUrl:getImageHttps(t),mainText:c,secondaryText:splitStr(e.promptContent),buttonText:e.buttonContent,showCard:!!i},e.linkContent&&(redpackSource.home.linkText=e.linkContent,redpackSource.home.link=e.linkUrl)}getColor(e)})),getColor(n[0])}catch(e){throw console.log(e),dialog.switch(),new Error("dataResolver函數解析數據失敗")}}function dataResolveForNewMember({diamond:e,coupon:t}){let o,n,r=[];if(0===e.length)throw console.log("白鑽數量錯誤，不顯示彈窗了"),new Error("白鑽數量錯誤");r.push(e[0].name),o=e[0].url,n=publicState.isDev?"https://bw.businessweekly.com.tw/assets/demo/2024-open-smart-recommand/setupMemberJobInfo?code=ux13fb7&todayTask=newMember":"https://www.businessweekly.com.tw/bwevent/2024/openSmartRecommand/setupMemberJobInfo?code=ux13fb7&todayTask=newMember",redpackSource.receive={type:2,title:"首登贈送",backgroundImage:"",imgUrl:o,mainText:r,secondaryText:[],buttonText:"",showCard:!1,linkText:"立刻開通",link:n},publicState.isBWPlusApp?redpackSource.receive.secondaryText=["已成功領取，請至我的-帳戶明細查看"]:redpackSource.receive.secondaryText=["已成功領取，請至會員中心查看"]}async function syncOperate(e){try{let t=await e.requestFunction(e.data);e.success&&e.success(t)}catch(t){console.log(t),e.error&&e.error(t)}}function serialize(e){let t="";for(let o in e)t+="&"+o+"="+e[o];return t.substring(1)}function errorResolve(e){try{e()}catch(e){console.log(e),dialog.switch(),show_receiveError_window({title:"系統忙錄",mainText:["系統忙錄","請稍後再試"],imgUrl:publicState.resourceURL+"/diamond.svg",buttonText:"我知道了"})}}console.log("202406231513");const pageOperation={speed:15,timer:null,getPositionY:function(){return window.scrollY||window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop},pageScroll:function(e){this.timer=setInterval((()=>{const t=this.getPositionY(),o=e>t?1:-1,n=Math.abs(t-e);let r=n>this.speed?-1===o?Math.ceil(o*(n/this.speed)):Math.floor(o*(n/this.speed)):o*n;document.documentElement.scrollTop=t+r,-1===o?(t<=e||n.toFixed(0)<1)&&this.stopPageScroll():(t>=e||n.toFixed(0)<1)&&this.stopPageScroll()}),20)},stopPageScroll:function(){clearInterval(this.timer)}},promiseAjax=({type:e="get",url:t,headers:o,data:n={},errorPop:r=!0})=>{const i=getCookieBySplitStr("token");return new Promise(((a,s)=>{$.ajax({type:e,url:publicState.baseURL+t,headers:o||{Authorization:"token="+i},xhrFields:{withCredentials:!0},crossDomain:!0,data:n,timeout:3e4,success(e){errorResolve((function(){const{code:t,message:o,result:n}=e;if(null==t||null==t)throw new Error("未獲取到返回狀態碼");if(200===t)a(e);else{let i;if(r)try{n&&n.redpackRecordVo&&n.redpackRecordVo.redpackRecordInfo&&(redpackState.status=n.redpackRecordVo.redpackRecordInfo.status||0),3034===t&&(redpackState.status=2),aimErrorMsg=n.pageError.find((e=>+e.type===t)),getColor(aimErrorMsg),i={title:aimErrorMsg.topContent,mainText:splitStr(aimErrorMsg.rewardContent),secondaryText:splitStr(aimErrorMsg.promptContent),imgUrl:getImageHttps(aimErrorMsg.rewardUrl),backgroundImage:getImageHttps(aimErrorMsg.backgroundUrl),buttonText:aimErrorMsg.buttonContent},aimErrorMsg.linkContent&&(i.linkText=aimErrorMsg.linkContent,i.link=aimErrorMsg.linkUrl),redpackSource.error=i}catch(e){3034===t&&(redpackState.status=2),i={title:o,mainText:[],imgUrl:publicState.resourceURL+"/diamond.svg",buttonText:"我知道了"}}finally{setColorValue(redpackSource.color.error),show_receiveError_window(i)}console.log(e),s(e)}}))},error(e){console.log(e),console.log("接口請求出錯了，不顯示彈窗了"),s(e)}})}))};function getRedpackInfo(e,t){return promiseAjax({url:"/infoVersion2",type:"post",data:e,errorPop:t})}function receiveRedpack(e){return promiseAjax({url:"/recevieVersion2",type:"post",data:e})}function getRedpackStatus({eventId:e,redpackIdStr:t="",identityKey:o}){return new Promise((async n=>{try{const r={eventId:e,redpackIdStr:t,identityKey:o};let{code:i,result:a}=await getRedpackInfo(r,!1);0!==i&&n(0),n(3034===i?2:a.redpackRecordVo.redpackRecordInfo.status)}catch(e){try{let{code:t,result:o}=e;n(3034===t?2:o.redpackRecordVo.redpackRecordInfo.status)}catch(e){n(0)}}}))}function receiveRedEnvelope(e,t=!1){return promiseAjax({url:"/newMemberReceive",type:"post",data:e,errorPop:t})}function whiteDiamondReciveHome(){const e=getCookieBySplitStr("device_id"),t=getCookieBySplitStr("token");return new Promise(((o,n)=>{$.ajax({type:"post",url:"https://m.businessweekly.com.tw/apis/resources/whiteDiamond/web/offlineWhiteDiamondBinding",xhrFields:{withCredentials:!0},crossDomain:!0,contentType:"application/x-www-form-urlencoded",timeout:3e4,data:{deviceId:e,token:t},success(e){o(e)},error(){n()}})}))}function requestWhiteDiamondReciveHome(e){if(getCookieBySplitStr("token"))whiteDiamondReciveHome().then((t=>{200===t.code&&localStorage.setItem("hasDailyDiamondReciveHome",e)}));else{const t=setTimeout((()=>{clearTimeout(t),requestWhiteDiamondReciveHome(e)}),500)}}const loadResource=({js:e=[],css:t=[],img:o=[]})=>{let n="";e.forEach((e=>{n=document.createElement("script"),n.type="text/javascript",n.src=e,$(n).insertBefore("script")})),t.forEach((e=>{n=document.createElement("link"),n.rel="stylesheet",n.type="text/css",n.href=e,$(n).appendTo("head")})),o.forEach((e=>{(new Image).src=e,redpackSource.cacheImage.push(e)}))};function api_user_info(){let e=getCookieBySplitStr("token");return new Promise(((t,o)=>{$.ajax({url:publicState.rAjaxUrl+"/member/v1/info",type:"GET",dataType:"json",beforeSend:function(t){t.setRequestHeader("token",e)},data:{},success:function(e){t(e)},error:function(){dialog.close()}})}))}function redPackToLogin(e,t,o,n){let r={url:"https://club.businessweekly.com.tw/#/login?origin="+e+t+t,index:o,action:n};setTimeout((function(){/Android/i.test(navigator.userAgent)?BW.goToIndex(JSON.stringify(r)):window.webkit.messageHandlers.goToIndex.postMessage(r)}),0)}function getMessage(e){if(console.log(e),"https://www.businessweekly.com.tw"===e.origin){const t=e.data;"string"==typeof t&&(t.indexOf("bwms-reload-")>-1?setCookieStr("alreadyLogin",!0):"bwms-close"===t?console.log("bwms-close"):"string"==typeof t&&t.indexOf("third-reload-")>-1?setCookieStr("alreadyLogin",!0):"bwms-to-service"===t&&console.log("bwms-to-service"))}}function redGoToRecord(e,t,o,n){let r="https://club.businessweekly.com.tw";setTimeout((function(){/Android/i.test(navigator.userAgent)?BW.openNewPage(`${r}/#/RedEnvelope/Double?origin=index&action=back`):window.webkit.messageHandlers.openNewPage.postMessage(`${r}/#/RedEnvelope/Double?origin=indexEvent&action=back`)}),0)}function redGoToExChange(e,t,o,n){let r="https://club.businessweekly.com.tw",i=`${r}/#/Coupon/Index?origin=${e}&action=back`;setTimeout((function(){/Android/i.test(navigator.userAgent)?BW.openNewPage(i):window.webkit.messageHandlers.openNewPage.postMessage(`${r}/#/Coupon/Index?origin=indexEvent&action=back`)}),0)}function goTo_login(){sessionStorage.setItem("redpackId",redpackState.redpackId),sessionStorage.setItem("eventId",redpackState.eventId),sessionStorage.setItem("identityKey",redpackState.identityKey),sessionStorage.setItem("redpackPositionY",pageOperation.getPositionY()),setCookieStr("toLogin",!0),publicState.isBWPlusApp?redPackToLogin("index","",3,1):window.memberSystem.openModal("login")}function goTo_record(){if(publicState.isBWPlusApp){if(outerEvent.jumpToRecordEvent)return dialog.close(),void outerEvent.jumpToRecordEvent();redGoToRecord("index","",3,1)}else console.log("跳轉到紅包記錄頁面"),window.location.href="https://www.businessweekly.com.tw/bwevent/2022/daily-redenvelop/record.html"}function goTo_Exchange(){publicState.isBWPlusApp?redGoToExChange("index","",3,1):window.location.href="https://www.businessweekly.com.tw/bwevent/2022/berich/cutscene.html"}function goTo_other(){publicState.isBWPlusApp?outerEvent.jumpToOther&&(dialog.close(),outerEvent.jumpToOther()):window.location.href="https://bwnet.pse.is/5d42qr"}async function update_loginStatus(e){if(publicState.isBWPlusApp){"0000"==(await api_user_info()).returnCode?(userState.isLogin=!0,console.log("已登錄，傳遞true")):(userState.isLogin=!1,console.log("未登錄，傳遞false")),e&&e()}else window.TokenBase&&window.TokenBase.Sum?userState.isLogin=!0:userState.isLogin=!1}const close_button='\n  <div id="close_button" class="close_button"></div>\n',switch_button='\n  <div id="switch_button" class="switch_button">\n    <div class="switch_container">\n      <button data-type="card"></button>\n      <button data-type="awards"></button>\n    </div>\n  </div>\n',save_button='\n  <div id="save_button" class="save_button">\n    <button>保存圖片</button>\n  </div>\n',card_Box=function(e){return e?`\n    <div class="card">\n      <div class="cover_bg" style="background-image:url(${e})"></div>\n    </div>\n  `:""},title_Box=function(e="系統異常"){return`\n  <div class="awards_header">${e}</div>\n  `},img_Box=function(e,t){let o;return e?(o=1===t?`\n        <div class="imgbox">\n          <img src="${e}" onerror="javascript:this.src='${publicState.resourceURL}/diamond.svg'" />\n        </div>\n      `:`\n        <div class="imgbox error">\n          <img src="${e}" onerror="javascript:this.src='${publicState.resourceURL}/diamond.svg'" />\n        </div>\n      `,o):'\n      <div class="imgbox placeholder"></div>\n    '},text_Box=function({textList:e,type:t=1}){let o,n,r=!1,i="";if(e){for(let t in redpackSource)if("object"==typeof redpackSource[t]&&null!==redpackSource[t]&&redpackSource[t].constructor==Object&&redpackSource[t].hasOwnProperty("linkText"))if(Array.isArray(e)){for(let r of e)if(r.includes(redpackSource[t].linkText)){o=redpackSource[t].linkText,n=redpackSource[t].link;break}}else e.includes(redpackSource[t].linkText)&&(o=redpackSource[t].linkText,n=redpackSource[t].link);Array.isArray(e)||(e=[e]),e=e.map((e=>{if(e.includes(o)){r=!0;const t=e.indexOf(o);switch(!0){case n.includes("record"):n="record";break;case n.includes("exchange"):n="exchange";break;case n.includes("other"):n="other"}return{start:e.slice(0,t),linkText:e.slice(t,t+o.length),link:n,end:e.slice(t+o.length)}}return e})),r?e.forEach((e=>{i+="object"!=typeof e?`<span>${e}</span>`:`\n          <span>\n          ${e.start?e.start:""}\n            <a href="javascript:;" data-link="${e.link}">${e.linkText}</a>\n          ${e.end?e.end:""}\n          </span>`})):e.forEach((e=>{i+=`<span>${e}</span>`})),i=1===t?`\n        <div class="textbox">\n          ${i}\n        </div>\n      `:`\n        <div class="promptbox">\n          ${i}\n        </div>\n      `}else i=1===t?'<div class="textbox"></div>':'<div class="promptbox"></div>';return i},button_Box=function({text:e,type:t}){let o="";return o=e?`\n    <div class="buttonbox">\n      <button data-type="${t}">${e}</button>\n    </div>\n    `:'\n    <div class="buttonbox placeholder"></div>\n    ',o};function transAwatds(e){let t;t="click"===e?$(this).attr("data-type"):"toleft"===e?"card":"awards","card"==t?$(".redpack_window").removeClass("showAwards").addClass("showCard"):"awards"==t&&$(".redpack_window").removeClass("showCard").addClass("showAwards")}function swipeAwatds(e,t){var o=!1,n=0,r=0,i=0,a=0,s={swipeLeft:function(){},swipeRight:function(){},swipeDown:function(){},swipeUp:function(){},drag:function(){}};Object.assign(s,t),(e=document.querySelector(e)).addEventListener("touchstart",(function(e){n=e.touches[0].pageX,r=e.touches[0].pageY})),e.addEventListener("touchmove",(function(t){o=!0,i=t.touches[0].pageX,a=t.touches[0].pageY,t.mation={startX:n,startY:r,moveX:i,moveY:a},s.drag.call(e,t)})),e.addEventListener("touchend",(function(t){o&&(Math.abs(i-n)>Math.abs(a-r)&&(i-n>0?s.swipeRight.call(e,t):s.swipeLeft.call(e,t)));o=!1}))}const dialog={flag:!0,conflictTime:50,delayTime:100,show:function(e){const t=setInterval((()=>{this.flag&&(clearInterval(t),this.flag=!1,$("body").append(e),$(".redpack_overlay").css({"z-index":"10002"}),setTimeout((()=>{$(".redpack_overlay .redpack_container").addClass("trans"),this.flag=!0,bindEvent(),eventFlag.setReceiveFlag(!0),eventFlag.setOtherFlag(!0)}),this.delayTime))}),this.conflictTime)},switch:function(){const e=setInterval((()=>{this.flag&&(clearInterval(e),this.flag=!1,$(".redpack_overlay").removeClass("active"),setTimeout((()=>{$(".redpack_overlay").remove(),this.flag=!0}),this.delayTime))}),this.conflictTime)},close:function(){const e=setInterval((()=>{this.flag&&(clearInterval(e),this.flag=!1,$(".redpack_mask").removeClass("active"),$(".redpack_overlay").removeClass("active"),setTimeout((()=>{$(".redpack_overlay").remove(),$(".redpack_mask").remove(),this.flag=!0}),this.delayTime))}),this.conflictTime)}},outerEvent={initEvent:null,receiveEvent:null,belongUserEvent:null,closeWindowEvent:null,jumpToRecordEvent:null,jumpToOther:null};function bindEvent(){0!==$("#close_button").length&&$("#close_button").on("click",(function(){dialog.close(),outerEvent.closeWindowEvent&&outerEvent.closeWindowEvent()})),0!==$(".redpack_result_box button").length&&$(".redpack_result_box").on("click",(async function(e){if("button"!==e.target.nodeName.toLowerCase())return;if(!eventFlag.otherFlag)return;eventFlag.setOtherFlag(!1);switch($(e.target).data("type")){case"toReceiveRedpack":dialog.switch();try{(new TrackEvents).setEvents("universal_receive_redpack","click",redpackState.redpackId,null,null)}finally{const e={redpackIdStr:redpackState.redpackId};let{result:t}=await receiveRedpack(e);dataResolver(t),showWindowByStatus()}break;case"toLogin":try{(new TrackEvents).setEvents("general_click_login","click",redpackState.redpackId,null,null)}finally{if(userState.isLogin){dialog.switch();const e={redpackIdStr:redpackState.redpackId};let{result:t}=await receiveRedpack(e);dataResolver(t),showWindowByStatus()}else goTo_login(),dialog.close()}break;case"closeDialog":dialog.close(),outerEvent.closeWindowEvent&&outerEvent.closeWindowEvent();break;case"exchange":eventFlag.setOtherFlag(!0),goTo_Exchange();break;case"record":eventFlag.setOtherFlag(!0),goTo_record()}})),0!==$("#switch_button").length&&($("#switch_button").on("click","button",(function(){transAwatds.call($(this)[0],"click")})),swipeAwatds(".withTransition",{swipeLeft:function(){transAwatds.call(null,"toleft")},swipeRight:function(){transAwatds.call(null,"toright")}})),0!==$("#save_button").length&&$("#save_button").on("click",(function(){if("0"===$(this).css("opacity"))return;let e=cardImg;e=0===e.lastIndexOf("//")?`https:${e}`:e,publicState.isAndroid?BW.saveToAlbum(e):window.webkit.messageHandlers.saveToAlbum.postMessage(e)})),0!==$(".redpack_result_box a").length&&$(".redpack_result_box").on("click",(function(e){if("a"!==e.target.nodeName.toLowerCase())return;switch($(e.target).data("link")){case"record":goTo_record();break;case"exchange":goTo_Exchange();break;case"other":goTo_other()}}))}function show_receiveInit_window(e){let{backgroundImage:t,mainText:o,buttonText:n}=e;let r=`\n  <div class="redpack_mask active"></div>\n  <div class="redpack_overlay active">\n    <div class="redpack_container">\n      <div class="redpack_window">\n        ${close_button}\n        <div class="redpack_result_box">\n          <div class="redpack_background" ${t?`style="background-image:url(${t})"`:'style="background-color:var(--redpack-window-backgroundColor)"'}></div>\n          <div class="redpack_content">\n            ${text_Box({textList:o,type:1})}\n            ${button_Box({text:n,type:"toReceiveRedpack"})}\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  `;dialog.show(r)}async function checkTrackEventsDefined(){return new Promise((function(e){let t=0;const o=setInterval((()=>{"undefined"!=typeof TrackEvents?(clearInterval(o),e(!0)):t>=15&&(clearInterval(o),e(!1)),t++}),200)}))}function goToOpenSmartRecommand(e){document.getElementById("goToOpenSmartRecommandBtn").disabled=!0,window.TrackEvents&&(new TrackEvents).setEvents("First_Login_Gift","Click_OSR",null,null,null),publicState.isBWPlusApp?publicState.isAndroid?window.BW.openNewPage(e):window.webkit.messageHandlers.openNewPage.postMessage(e):window.location.href=e}function show_receiveSuccess_window({type:e,title:t,backgroundImage:o,imgUrl:n,mainText:r,secondaryText:i,buttonText:a,showCard:s,cardImg:c,linkText:l,link:d}){let u,p;if(1==+e)u="toLogin";else u="closeDialog";if("查看領取記錄"===a)u="record";o&&(p=`style="background-image:url(${o});background-position:center;background-size:cover;"`);const g=$(".redpack_mask").length>0;let v=`\n    <div class="open_smart_recommend">\n      <div class="gift_imgbox">\n        <img src="${publicState.resourceURL}/new-member-gift.svg" onerror="javascript:this.src='${publicState.resourceURL}/new-member-gift.svg'" />\n      </div>\n      <div class="gift_textbox">開啟智慧推薦 再送 <span class="hight_light">150</span> 鑽</div>\n      <button type="button" id="goToOpenSmartRecommandBtn" class="open_service_btn" onClick="goToOpenSmartRecommand('${d}')">${l}</button>\n    </div>\n  `,k=`\n    <div class="splitbox"></div>\n    ${button_Box({text:a,type:u})}\n  `,m=`\n  ${g?"":'<div class="redpack_mask active"></div>'}\n  <div class="redpack_overlay active ${s?"withTransition":""}">\n    <div class="redpack_container">\n      <div class="redpack_window">\n        ${close_button}\n        <div class="redpack_result_box ${2==+e?"newMember":""}">\n          ${s?card_Box(c):""}\n          <div class="awards" ${p||""}>\n            ${title_Box(t)}\n            <div class="awards_content">\n              ${img_Box(n,1)}\n              ${text_Box({textList:r,type:1})}\n              ${text_Box({textList:i,type:2})}\n              ${2==+e?v:k}\n            </div>\n          </div>\n        </div>\n        ${s?switch_button:""}\n        ${s&&publicState.isBWPlusApp?save_button:""}\n      </div>\n    </div>\n  </div>\n  `;dialog.show(m)}function show_receiveError_window(e){let t,o,{title:n,mainText:r,secondaryText:i,backgroundImage:a,imgUrl:s,buttonText:c}=e;switch(c){case"我知道了":t="closeDialog";break;case"我要兌換":t="exchange"}a&&(o=`style="background-image:url(${a});background-position:center;background-size:cover;"`);let l=`\n  ${$(".redpack_mask").length>0?"":'<div class="redpack_mask active"></div>'}\n  <div class="redpack_overlay active withTransition">\n    <div class="redpack_container">\n      <div class="redpack_window">\n        ${close_button}\n        <div class="redpack_result_box">\n          <div class="awards" ${o||""}>\n            ${title_Box(n)}\n            <div class="awards_content">\n              ${img_Box(s,2)}\n              ${text_Box({textList:r,type:1})}\n              ${text_Box({textList:i,type:2})}\n              <div class="splitbox"></div>\n              ${button_Box({text:c,type:t})}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  `;dialog.show(l)}function showWindowByStatus(){switch(redpackState.status){case 0:setColorValue(redpackSource.color.init),show_receiveInit_window(redpackSource.init);break;case 1:setColorValue(redpackSource.color.receive),setTimeout((()=>{show_receiveSuccess_window(redpackSource.receive)}),500);break;case 2:setColorValue(redpackSource.color.home),setTimeout((()=>{show_receiveSuccess_window(redpackSource.home)}),500)}}if(publicState.ua=navigator.userAgent,publicState.URL=location.href,publicState.isBWPlusApp=publicState.ua.includes("Name/BW"),publicState.isH5=/(iphone|ipad|android|ios|windows mobile|windows ce|ucweb|webOS|iPod|BlackBerry)/i.test(publicState.ua),publicState.isPC=!publicState.isH5,publicState.isAndroid=/android/i.test(publicState.ua),publicState.isIOS=/(iPhone|iPad|iPod|iOS)/i.test(publicState.ua),publicState.isDev=/127\.0\.0\.1|10\.101\.2\.164:5500|localhost|bwplus\.com\.tw/gi.test(publicState.URL),publicState.isDev?(publicState.baseURL="https://club.bwplus.com.tw/api/activity/redpack/universal",publicState.resourceURL="https://static.bwplus.com.tw/redpack/imgs"):(publicState.baseURL="https://club.businessweekly.com.tw/api/activity/redpack/universal",publicState.URL.includes("staging")?publicState.resourceURL="https://static.bwplus.com.tw/redpack/imgs":publicState.resourceURL="https://static.businessweekly.com.tw/redpack/imgs"),publicState.rAjaxUrl="https://lottery.businessweekly.com.tw/api",getUrlParames(),sessionStorage.getItem("redpackId")&&(redpackState.redpackId=sessionStorage.getItem("redpackId")||""),sessionStorage.getItem("eventId")&&(redpackState.eventId=sessionStorage.getItem("eventId")||""),sessionStorage.getItem("identityKey")&&(redpackState.identityKey=sessionStorage.getItem("identityKey")||""),publicState.urlParams.redpackIdStr&&(redpackState.redpackId=publicState.urlParams.redpackIdStr||""),publicState.urlParams.identityKey&&(redpackState.identityKey=publicState.urlParams.identityKey||""),localStorage.getItem(redpackState.eventId)){const e=JSON.parse(localStorage.getItem(redpackState.eventId));redpackSource.color=e}let loginCount=0;async function initRedpack(e={}){let t,o,n;if(console.log("1.紅包彈窗程式開始觸發咯"),e.closeWindowEvent&&(outerEvent.closeWindowEvent=e.closeWindowEvent),e.jumpToRecordEvent&&(outerEvent.jumpToRecordEvent=e.jumpToRecordEvent),e.jumpToOtherEvent&&(outerEvent.jumpToOther=e.jumpToOtherEvent),e.ssoUserId&&(n=String(e.ssoUserId)),publicState.isBWPlusApp)console.log("APP 判斷首登禮");else if(publicState.URL.includes("club.businessweekly.com.tw"));else{if(!window.TokenBase||!window.TokenBase.OSum){if(loginCount>9)return e.closeWindowEvent&&outerEvent.closeWindowEvent(),localStorage.removeItem("hasDailyDiamondReciveHome"),void console.log("error.沒有獲取到登録的信息，不顯示彈窗了");loginCount++;const t=setTimeout((()=>{clearTimeout(t),initRedpack()}),500);return}if(window.TokenBase.OSum){const e=localStorage.getItem("hasDailyDiamondReciveHome");n=String(window.TokenBase.OSum),+e!=+n&&requestWhiteDiamondReciveHome(n)}}console.log("2.已經成功登陸賬戶");try{if(getCookieBySplitStr("hasNewMemberRedpack")===n)return e.closeWindowEvent&&outerEvent.closeWindowEvent(),console.log("3.當前用戶已經領取過了，不顯示彈窗了")}catch(t){return console.log(t),e.closeWindowEvent&&outerEvent.closeWindowEvent(),console.log("error.判斷是否領取過的程式出現錯誤了，不顯示彈窗了")}console.log("4.要開始請求接口了");try{const e={requestOriginUrl:publicState.URL};let{code:n,result:r}=await receiveRedEnvelope(e);if(console.log("5.請求接口成功了"),200!==n)return outerEvent.closeWindowEvent&&outerEvent.closeWindowEvent(),void console.log("error.請求接口返回碼不為200，不顯示彈窗");const{wdiamon:i,coupon:a}=r;if(!i.length)return outerEvent.closeWindowEvent&&outerEvent.closeWindowEvent(),void console.log("error.請求數據鑽石返回數據錯誤，不顯示彈窗");t=i,o=a}catch(e){return console.log(e),outerEvent.closeWindowEvent&&outerEvent.closeWindowEvent(),void console.log("error.請求接口失敗，不顯示彈窗")}try{dataResolveForNewMember({diamond:t,couponList:o}),console.log("6.彈窗數據處理完成"),setColorValue({"window-backgroundColor":"#F5F4F4","title-color":"#424242","content-color":"#424242","prompt-color":"#CD0505","link-color":"#0E57CD","split-color":"#CD0505","button-backgroundColor":"#CD0505","button-backgroundColor--active":"#CD0505"}),console.log("7.顔色數據處理完成"),console.log(redpackSource.receive),show_receiveSuccess_window(redpackSource.receive);const e=await checkTrackEventsDefined();console.log("數據追蹤, 彈窗曝光事件",e),e&&(new TrackEvents).setEvents("First_Login_Gift","Impression",null,null,null),console.log("8.顯示彈窗成功啦~")}catch(e){console.log(e),console.log("error.顯示彈窗的過程中出現錯誤"),outerEvent.closeWindowEvent&&outerEvent.closeWindowEvent()}}publicState.isBWPlusApp||initRedpack(),window.generalRedpack={eventFlag:eventFlag,initRedpack:initRedpack};
/*! For license information please see utkBase.min.js.LICENSE.txt */
(()=>{window.afterBWGI=!1,window.oneBWGI=!1,document.cookie.replace(/(?:(?:^|.*;\s*)device_id\s*\=\s*([^;]*).*$)|^.*$/,"$1");var e="";function t(){return new Promise((function(e,t){if(document.getElementById("gtm_content_type")&&document.getElementById("gtm_content_type").value.length>0&&null!==document.getElementById("gtm_content_type")){var s,i=document.getElementById("gtm_content_type").value||"";s=document.getElementById("gtm_id_list")&&document.getElementById("gtm_id_list").value.length>0?document.getElementById("gtm_id_list").value:document.getElementById("gtm_note_id").value||"",article_id=i+"-"+s,resource_id=i+"-"+s,article_id&&e(article_id)}else article_id=document.getElementById("gtm_note_id")?document.getElementById("gtm_note_id").value:"",resource_id=document.getElementById("gtm_note_id")?document.getElementById("gtm_note_id").value:"",article_id&&e(article_id)}))}document.getElementById("gtm_content_type")&&(resource_type=document.getElementById("gtm_content_type").value||""),document.getElementById("gtm_computer_name")&&(server_id=document.getElementById("gtm_computer_name").value||""),window.trackAPIUrl="//sta.cmh.com.tw/apis/track/track2/v2",window.cookiePrefix="toc_";var s=window.location!==window.parent.location;if((window.ActiveXObject||"ActiveXObject"in window)&&(loader("https://ibw.bwnet.com.tw/assets/library/lib/promise-polyfill.min.js"),loader("https://ibw.bwnet.com.tw/assets/library/lib/closest-polyfill.js"),loader("https://ibw.bwnet.com.tw/assets/library/lib/intersection-observer.js")),!window.oneBWGI&&!s){window.oneBWGI=!0;var i=window.location.host;switch(i){case"www.businessweekly.com.tw":var n=window.location.pathname.toLowerCase();if(n.indexOf("bookshop")>-1)app_key="bw_store",site_id="bw_store";else if(n.indexOf("event/")>-1)app_key="bw_event",site_id="bw_event";else if(n.indexOf("roundtable/")>-1)app_key="bw_event",site_id="bw_event";else if(n.indexOf("archive")>-1)app_key="bw_archive",site_id="bw_archive";else if(n.indexOf("order/")>-1)switch(site_type){case"BwBookStore":default:app_key="bw_store",site_id="bw_store";break;case"Knowledge":app_key="bw_archive",site_id="bw_archive";break;case"BwCollege":case"BwCEO":case"BwCEOLeader":app_key="bw_learning",site_id="bw_learning";break;case"Health":app_key="health_web",site_id="health_web";break;case"alive":app_key="alive_web",site_id="alive_web";break;case"Smart":app_key="smart_web",site_id="smart_web"}else app_key="bw_web",site_id="bw_web";break;case"campaign.businessweekly.com.tw":app_key="bw_event",site_id="bw_event";break;case"member.businessweekly.com.tw":app_key="bw_web",site_id="bw_web";break;case"bwlearning.businessweekly.com.tw":app_key="bw_learning",site_id="bw_learning";break;case"smart.businessweekly.com.tw":case"smarttest.businessweekly.com.tw":app_key="smart_web",site_id="smart_web";break;case"health.businessweekly.com.tw":app_key="health_web",site_id="health_web";break;case"wealth.businessweekly.com.tw":app_key="wealth_web",site_id="wealth_web";break;case"alive.businessweekly.com.tw":app_key="alive_web",site_id="alive_web";break;case"wegrow.businessweekly.com.tw":app_key="wegrow_web",site_id="wegrow_web";break;case"health.bwplus.com.tw":case"health-stage.businessweekly.com.tw":case"club.bwplus.com.tw":case"www3.businessweekly.com.tw":case"www.businessweekly.com.tw/Archive3/":case"frontdev.businessweekly.com.tw":case"staging.businessweekly.com.tw":app_key="testbw_web",site_id="testbw_web";break;default:i.indexOf("bw.")>-1?(app_key="bw_event",site_id="bw_event"):(app_key="bw_web",site_id="bw_web")}navigator.userAgent.indexOf("Name/BW")>-1&&(app_key="bw_app",site_id="bw_app"),BWGI().then((function(e){if(![9999,9001].includes(e.errorCode)&&0!==e.errorCode){var s=(new Date).getDate().toString();s!==Cookies.get("cc_compare")&&(Cookies.remove("BWG_CC",{path:"/",domain:".businessweekly.com.tw"}),Cookies.remove("BWG_C",{path:"/",domain:".businessweekly.com.tw"}),Cookies.remove("MC_m",{path:"/",domain:".businessweekly.com.tw"}),Cookies.remove("MC_s",{path:"/",domain:".businessweekly.com.tw"}),Cookies.set("cc_compare",s,{expires:7,domain:".businessweekly.com.tw"}),window.location.href.includes(".businessweekly.com.tw")&&setTimeout(window.location.reload.bind(window.location),400))}navigator.userAgent.indexOf("Name/BW")>-1?user_id=document.cookie.replace(/(?:(?:^|.*;\s*)user_id\s*\=\s*([^;]*).*$)|^.*$/,"$1")||null:user_id=e.jData.id?e.jData.id:null,t()})).catch((function(e){user_id=null,t()})).then((function(){return window.afterBWGI=!0,new Promise((function(t,s){try{e=document.cookie.replace(/(?:(?:^|.*;\s*)device_id\s*\=\s*([^;]*).*$)|^.*$/,"$1")||"",t()}catch(e){console.log(e),s(e)}})).then((function(){window.getDeviceId=function(){return new Promise((function(t){t(e)}))}}))})).then((function(){let e="";var t;e="staging.businessweekly.com.tw"===window.location.hostname||"frontdev.businessweekly.com.tw"===window.location.hostname||"www3.businessweekly.com.tw"===window.location.hostname||"https://member.businessweekly.com.tw/member-newtab-right2.html"===window.location.href?"https://static.bwplus.com.tw/secure-token/secure-token.min.js":"https://static.businessweekly.com.tw/secure-token/secure-token.min.js",(t=e,new Promise(((e,s)=>{const i=document.createElement("script");i.src=t,i.onload=()=>e(),i.onerror=()=>s(new Error(`Script load error for ${t}`)),document.head.appendChild(i)}))).then((()=>{window.secureToken&&"function"==typeof window.secureToken.regist?window.secureToken.regist({onRegistSuccessCb:({message:e})=>{const t=document.createElement("script");t.src="https://static.cmh.com.tw/track/track.v3.min.js?v=20240723",document.head.appendChild(t)},onTransferTokenSuccessCb:({message:e})=>{}}):console.log("secureToken.regist未定義")})).catch((e=>{console.error("secureToken.regist加載失敗",e)}))}))}})();
let gtm_siteurl = document.getElementById('gtm_siteurl');
let view_end = document.getElementById('view_end');
if (gtm_siteurl) {
    if (gtm_siteurl.value == 'archive.businessweekly.com.tw') {
        if (view_end) {
            const elOptions = {
                root: null,
                rootMargin: '0px 0px 0px 0px',
                threshold: 0,
            };
            const ViewFunc = function (entry, observer) {

                if (entry[0].isIntersecting) {
                    try {
                        /*console.log(entry[0].target.id);*/
                        let targetid = entry[0].target.id;
                        switch (targetid) {
                            case "view_end":
                                var rtype = 1;
                                var utm_source = GetUrlParameter('utm_source');
                                var utm_campaign = GetUrlParameter('utm_campaign');
                                var da = GetUrlParameter('da');
                                var emcat = GetUrlParameter('emcat');
                                var StrId = GetUrlParameter('StrId');
                                if (utm_source != '' && utm_campaign != '' && da != '' && emcat != '' && StrId != '') {
                                    var script = document.createElement("script");
                                    script.type = "text/javascript";
                                    script.src = 'https://static.businessweekly.com.tw/web_daily_article/daily_diamond.min.js';
                                    document.body.appendChild(script);
                                    script.onload = function (e) {
                                        //console.log('script')
                                        var link = document.createElement("link");
                                        link.rel = "stylesheet";
                                        link.type = "text/css";
                                        link.href = 'https://static.businessweekly.com.tw/web_daily_article/daily_diamond.min.css';
                                        document.body.appendChild(link);
                                        link.onload = function (b) {
                                            //console.log('link')
                                            if (document.getElementById("type_f").value == "f") {
                                                rtype = 0;
                                            }

                                            window.initDailyDiamond(
                                                rtype,
                                                window.location.href,
                                                document.head.querySelector('meta[name="og:title"]').content);
                                        }
                                    }
                                }
                                break;
                        }
                        observer.unobserve(entry[0].target);
                    } catch (err) { throw err }
                }
            };
            const Viewobserver = new IntersectionObserver(ViewFunc, elOptions);
            setTimeout(() => {
                Viewobserver.observe(view_end);
            }, 200);
        }
    }
    if (gtm_siteurl.value == 'businessweekly.com.tw') {
        
        if (view_end) {
            view_end.style = "height:2px";
            const elOptions = {
                root: null,
                rootMargin: '0px 0px 0px 0px',
                threshold: 0,
            };
            const ViewFunc = function (entry, observer) {
                
                
                if (entry[0].isIntersecting) {
                    try {
                        let targetid = entry[0].target.id;
                        switch (targetid) {
                            case "view_end":
                                var rtype = 0;
                                var script = document.createElement("script");
                                script.type = "text/javascript";
                                script.src = 'https://static.businessweekly.com.tw/web_daily_article/daily_diamond.min.js';
                                document.body.appendChild(script);
                                script.onload = function (e) {
                                    var link = document.createElement("link");
                                    link.rel = "stylesheet";
                                    link.type = "text/css";
                                    link.href = 'https://static.businessweekly.com.tw/web_daily_article/daily_diamond.min.css';
                                    document.body.appendChild(link);
                                    link.onload = function (b) {

                                        window.initDailyDiamond(
                                            rtype,
                                            window.location.href,
                                            document.head.querySelector('meta[property="og:title"]').content);
                                    }
                                }
                                break;
                        }
                        observer.unobserve(entry[0].target);
                    } catch (err) { throw err }
                }
            };
            const Viewobserver = new IntersectionObserver(ViewFunc, elOptions);
            setTimeout(() => {
                Viewobserver.observe(view_end);
                
            }, 200);
        }
    }
}
